#Тестовое задание PHP (Billing)
Микросервис баланса пользователей.

Приложение хранит в себе идентификаторы пользователей и их баланс. Взаимодействие с ним осуществляется исключительно с помощью брокера очередей.

По требованию внешней системы, микросервис может выполнить одну из следующих операций со счетом пользователя:
* Списание
* Зачисление
* Блокирование с последующим списанием или разблокированием. Заблокированные средства недоступны для использования.
* Перевод от пользователя к пользователю
* При проведении любой из этих операций генерируется событие в одну из очередей.

Основные требования к воркерам:
* Код воркеров должен безопасно выполняться параллельно в разных процессах
* Воркеры могут запускаться одновременно в любом числе экземпляров и выполняться произвольное время
* Все операции должны обрабатываться корректно, без двойных списаний.

Будет плюсом покрытие кода юнит-тестами.

### Требования к окружению:

Язык программирования: PHP >= 5.5

Можно использовать: любые фреймворки, БД, брокеры очередей, key-value хранилища.

## Уточнения
1. **Вопрос:** Может ли быть несколько блокировок? Или если одна сумма уже заблокирована, то можно либо ее списать, либо снять блокировку, при этом дополнительную блокировку уже не сделать?
    
    **Ответ:** Если остается доступная сумма, то можно заблокировать ее, если нет, то нет

2. **Вопрос:** А списание блокировки происходит ровно на ту сумму, которая была в одной из блокировок или на весь объем блокировки?
    
    **Ответ:** Ровно на ту сумму, то есть блокировка - это когда операция находится на авторизации и ждет какого-то внешнего подтверждения, ее можно впоследствии подтвердить или отклонить

3. **Вопрос:** Подскажите пожалуйста еще один момент по заданию.

    Необходимо ли рассчитать систему таким образом, чтобы она была защищена от дублирования списаний (и других операций) в следствие падения брокера очередей? Или же достаточно защитить от дублирования операций в следствие падения воркеров?

    Например в https://www.rabbitmq.com/semantics.html есть абзац:
    For acknowledgements, the receipt of a tx.commit-ok is an indicator that the acknowledgements have been received by the server, not that they have been processed, persisted, etc. Consequently it is possible for a subsequent server-side failure to "resurrect" the acknowledged messages, and for consuming clients to receive them again.

    **Ответ:** думаю, что защита должна быть от любого дублирования